<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <link rel="stylesheet" href="./install/ChemDoodleWeb.css" type="text/css" />
    <link
      rel="stylesheet"
      href="./install/uis/jquery-ui-1.11.4.css"
      type="text/css"
    />

    <script type="text/javascript" src="./install/ChemDoodleWeb.js"></script>
    <script
      type="text/javascript"
      src="./install/uis/ChemDoodleWeb-uis.js"
    ></script>
    <title>ChemDoodle Web Component Sketcher (Full Sketcher)</title>
  </head>
  <body>
    <script>
      ChemDoodle.ELEMENT['H'].jmolColor = 'black';
      ChemDoodle.ELEMENT['S'].jmolColor = '#B9A130';

      var sketcher = new ChemDoodle.SketcherCanvas('sketcher', 268, 300, {
        useServices: false,
        oneMolecule: true,
      });
      sketcher.styles.atoms_displayTerminalCarbonLabels_2D = true;
      sketcher.styles.atoms_useJMOLColors = true;
      sketcher.styles.bonds_clearOverlaps_2D = true;
      sketcher.repaint();

      window.addEventListener('message', function (evt) {
        try {
          const payload = JSON.parse(evt.data);

          const { type, content } = payload;
          switch (type) {
            case 'selectFile':
              const mol = ChemDoodle.readMOL(content);
              sketcher.loadMolecule(mol);
              break;
            case 'getMol':
              const newMol = sketcher.getMolecule();
              const molStr = ChemDoodle.writeMOL(newMol);

              window.parent.postMessage(
                JSON.stringify({
                  type: 'getMol',
                  content: molStr,
                })
              );
              break;
            default:
              break;
          }
        } catch (error) {
          console.error(error);
        }
      });
    </script>
  </body>
</html>
